<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://code.responsivevoice.org/responsivevoice.js?key=YOUR_API_KEY"></script> <!-- Replace YOUR_API_KEY with your actual key -->
</head>
<body>
    <header>
        <h1>Welcome {{ child.username }}</h1>
        <h2>Category: {{ category.name }}</h2>
    </header>

    <main>
        <h3>Listen to the word and select the matching image:</h3>
        <button id="play-audio">Play Audio</button>

        <div class="options" id="options-container">
            <!-- Images will be dynamically inserted here -->
        </div>

        <p>Time left: <span id="timer">15</span> seconds</p>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            fetchQuestions('{{ category.id }}');
        });

        function fetchQuestions(category) {
            fetch(`/questions/${category}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const question = data[0]; // Assuming you are using the first question
                        const audioText = question.options.find(opt => opt.id === question.correct_answer_id).name;
                        document.getElementById('play-audio').onclick = () => playAudio(audioText);
                        renderOptions(question.options, question.correct_answer_id);
                    }
                })
                .catch(error => console.error('Error fetching questions:', error));
        }

        function playAudio(text) {
            responsiveVoice.speak(text, "US English Female");
        }

        function renderOptions(options, correctId) {
            const container = document.getElementById('options-container');
            container.innerHTML = ''; // Clear any existing options

            options.forEach(option => {
                const img = document.createElement('img');
                img.src = `{{ url_for('static', filename='images/') }}${option.image}`;
                img.alt = option.name;
                img.onclick = () => selectImage(option.id, correctId);

                const div = document.createElement('div');
                div.className = 'option';
                div.appendChild(img);
                container.appendChild(div);
            });
        }

        function selectImage(selectedId, correctId) {
            // Prepare form data
            const form = document.createElement('form');
            form.method = 'post';
            form.action = "{{ url_for('game.submit_answer', child_id=child.id, category_id=category.id) }}";

            const selectedInput = document.createElement('input');
            selectedInput.type = 'hidden';
            selectedInput.name = 'selected_image_id';
            selectedInput.value = selectedId;
            form.appendChild(selectedInput);

            const correctInput = document.createElement('input');
            correctInput.type = 'hidden';
            correctInput.name = 'correct_image_id';
            correctInput.value = correctId;
            form.appendChild(correctInput);

            document.body.appendChild(form);
            form.submit();
        }

        // Countdown timer
        let timeLeft = 15;
        const timerElement = document.getElementById('timer');
        const timerInterval = setInterval(function() {
            timeLeft -= 1;
            timerElement.textContent = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                // Auto-submit if no selection was made
                selectImage(-1, {{ correct_element.id }});
            }
        }, 1000);
    </script>
</body>
</html>

